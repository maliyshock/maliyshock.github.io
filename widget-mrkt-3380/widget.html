<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="side_banner.css">
</head>
<body>
    <div class="widget_text sidebar-box widget_custom_html clr">
        <div class="textwidget custom-html-widget">
            <div class="sideBanner banner" id="sticky-bar" href="undefined&amp;utm_medium=/chem-otlichaetsya-britanskij-anglijskij-yazyk-ot-amerikanskogo" style="/* height: 524px; *//* padding: 0px; *//* border: 0px; */">
                <div class="banner__inner" style="">

                    <div class="popup js-popup">
                        <div class="popup__inner">
                            <p class="popup__text js-popup-text"></p>
                            <button type="button" class="wpcf7-form-control wpcf7-submit js-popup-close">Ok</button>
                        </div>
                    </div>

                    <div class="sideBanner__body">
                        <div class="sideBanner__logo"></div>
                        <div class="sideBanner__swapBlock">
                            <div class="sideBanner__swapItem sideBanner__swapItem_1 active js-sidebanner-item" data-banner-num="1" style="display: block;">
                                <div class="sideBanner__swapItem__text">
                                    <span>Подберем преподавателя мечты</span>
                                </div>
                            </div>
                            <div class="sideBanner__swapItem sideBanner__swapItem_2 js-sidebanner-item" data-banner-num="2" style="display: none;">
                                <div class="sideBanner__swapItem__text">
                                    <span>Поставим цели</span>
                                </div>
                            </div>
                            <div class="sideBanner__swapItem sideBanner__swapItem_3 js-sidebanner-item" data-banner-num="3" style="display: none;">
                                <div class="sideBanner__swapItem__text">
                                    <span>Определим уровень английского</span>
                                </div>
                            </div>
                        </div>
                        <div class="sideBanner__formText">
                            <span>Оставьте заявку на бесплатный пробный урок</span>
                        </div>
                        <div role="form" class="wpcf7" id="wpcf7-f7026-o2" lang="ru-RU" dir="ltr">
                            <div class="screen-reader-response"></div>
                            <form action="" method="post" class="wpcf7-form" id="order-form">
                                <div class="banner__form__container">
                                    <div class="banner__form__item banner__form__item__name">
                                        <span class="wpcf7-form-control-wrap your-name">
                                            <input type="text" name="name" value="" size="40" class="wpcf7-form-control wpcf7-text banner__form__name" aria-invalid="false" placeholder="Имя">
                                        </span>
                                    </div>

                                    <div class="banner__form__item banner__form__item__phone">
                                        <span class="wpcf7-form-control-wrap your-phone">
                                            <input type="tel" name="phone" value="" class="wpcf7-form-control wpcf7-text wpcf7-tel wpcf7-validates-as-required wpcf7-validates-as-tel banner__form__phone js-phone" data-parsley-errors-messages-disabled required="" placeholder="Телефон">
                                        </span>
                                    </div>

                                    <div class="banner__form__item banner__form__item__email">
                                        <span class="wpcf7-form-control-wrap your-email">
                                            <input type="email" name="email" value="" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email banner__form__email" data-parsley-errors-messages-disabled required="" placeholder="Email">
                                        </span>
                                    </div>

                                    <div class="banner__form__item banner__form__item__submit">
                                        <button type="submit" value="Отправить" class="wpcf7-form-control wpcf7-submit">Отправить</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="jquery.js"></script>
    <script src="https://skyeng.ru/files/scripts/lp-order-creator.js"></script>
    <script src="jquery.inputmask.bundle.js"></script>
    <script src="parsley.min.js"></script>

    <script>
        function getJsonFromUrl() {
            var query = location.search.substr(1);
            var result = {};
            query.split("&").forEach(function(part) {
                var item = part.split("=");
                result[item[0]] = decodeURIComponent(item[1]);
            });
            return result;
        }

        $(document).ready(function() {
            var jsonFromUrl = getJsonFromUrl();
            var dataType = jsonFromUrl['type'];
            var utmMedium = jsonFromUrl['utm-medium'];
            var utmSource = jsonFromUrl['utm-source'];
            var popup = $('.js-popup');
            var popupText = $('.js-popup-text');
            var currentItem = 1;


            var intervalID = window.setInterval(myCallback, 3000);

            function myCallback() {
                if(currentItem >= 3) {
                    currentItem = 1;
                } else {
                    currentItem ++;
                }

                $('.js-sidebanner-item.active').removeClass('active').css({'display':'none'});
                $('.js-sidebanner-item[data-banner-num='+ currentItem+']').addClass('active').fadeIn();
            }

            $('#order-form').parsley().on('field:validated', function() {
                // var ok = $('.parsley-error').length === 0;
            });

            $('.js-popup-close').on('click', function () {
                $(this).closest('.js-popup').fadeOut();
            });

            $('#order-form').on('submit', function(event) {
                event.preventDefault();  // отменяем стандартную отправку формы
                var $form = $(this);
                skyengCreateOrder({
                    name: $form.find('input[name=name]').val(),
                    email: $form.find('input[name=email]').val(),
                    phone: $form.find('input[name=phone]').val(),
                    extraData: {
                        source_type: dataType,
                        utm_source: utmMedium,
                        utm_medium: utmSource,
                    }
                }).then(function (result) {
                    /** обработка успешного результата */
                    popupText.text('Спасибо за Ваше сообщение. Оно успешно отправлено.');

                    popup.css("display", "flex")
                        .hide()
                        .fadeIn();
                }, function (errors) {
                    /** обработка ошибок, объект errors содержит сообщения об ошибках в полях name, email, phone */

                    var errorMsgName = errors.name ? '<p>' + errors.name+'</p> ' : '';
                    var errorMsgEmail = errors.email ? '<p>' + errors.email+'</p> ' : '';
                    var errorMsgPhone = errors.phone ? '<p>' + errors.phone +'</p> ': '';

                    var errorMsg =  '<p>Ошибка сервера. Попробуйте снова</p> ' + errorMsgName + errorMsgEmail + errorMsgPhone;

                    popupText.html(errorMsg);

                    popup.css("display", "flex")
                        .hide()
                        .fadeIn();
                });
            });
        });
    </script>
</body>
</html>
