(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){e.exports=n(24)},19:function(e,t,n){},21:function(e,t,n){},23:function(e,t){},24:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),i=n(12),r=n.n(i),o=(n(19),n(2)),u=n(9),c=n(3),h=n(4),l=n(6),p=n(5),m=n(7),k=n(13),v=n(1),f=n.n(v),d=10,y=10;function b(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!==typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function C(e,t){return"undefined"===typeof t||0===+t?Math.round(e):(e=+e,t=+t,isNaN(e)||"number"!==typeof t||t%1!==0?NaN:(e=e.toString().split("e"),+((e=(e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+t:t))))}function N(e,t,n){return e+t*n}function g(e,t,n,s){var a=N(e,n,d),i=N(t,s,y);return{a_x:a,a_y:i,absCoordinates:"x".concat(a,"y").concat(i)}}function w(e){for(var t=f.a.chunk(e,y),n={},s=0;s<t.length;s++)for(var a=0;a<t[s].length;a++)for(var i=t[s][a],r=0,o=0;o<i.length;o+=d){var u=i.slice(o,o+d);f.a.isEmpty(n["row_".concat(s)])&&(n["row_".concat(s)]={}),f.a.isEmpty(n["row_".concat(s)]["col_".concat(r)])&&(n["row_".concat(s)]["col_".concat(r)]={map:[],suspiciousnessLevel:{}}),n["row_".concat(s)]["col_".concat(r)].map.push(u),r++}return n}function x(e){return/^(?=.*\d)(?=.*[1-9]).{1,10}$/.test(e)}function _(e){return e.match(/\d+/g).map(Number)[0]}var O=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={highlited:!1},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"cellHandler",value:function(e,t,n){this.props.socket.send("open ".concat(n," ").concat(t))}},{key:"setMine",value:function(e){return e.preventDefault(),e.persist(),this.setState({highlited:!this.state.highlited}),!1}},{key:"getColor",value:function(e){switch(e){case"\u25a1":case"0":return"gray";case"1":return"blue";case"2":return"green";case"3":return"red"}}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e,t,n=this,s=0,i=this.props.item,r=this.props.itemKey,o=this.props.rowKey,u="\u25a1"!==i?"button--bg-gray button--color-".concat(this.getColor(i)):"",c="\u25a1"===i||"0"===i?"":i;return void 0!==this.props.suspiciousnessLevel?(s=this.props.suspiciousnessLevel.counter,e=this.props.suspiciousnessLevel.value,t="\u25a1"===i?"".concat(C(100*e,-2),"% \n(").concat(s,")"):""):t="",this.props.isMine&&(u+=" mine"),this.props.isSafe&&(u+=" safe"),this.state.highlited&&(u+=" pseudo-mine"),a.a.createElement("li",{className:"map__cell",onContextMenu:function(e){return n.setMine(e)},onClick:function(){return n.cellHandler(n.props.socket,o,r)},key:r},a.a.createElement("button",{title:c,className:"map__button button ".concat(u)},"\u25a1"===i?"":i),a.a.createElement("div",{className:"map__cell-hint map__cell-hint--".concat(s)},t))}}]),t}(a.a.Component),S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props.isActive?" active":"",n=this.props.chunkMap.map(function(t,n){var s=t.split("").map(function(s,i){var r,o,u=N(i,e.props.colMultiplier,d),c=N(n,e.props.rowMultiplier,y),h="x".concat(u,"y").concat(c),l="x".concat(i,"y").concat(n);r=h in e.props.mines,o=h in e.props.safe;var p=void 0!==e.props.suspiciousnessLevel?e.props.suspiciousnessLevel[l]:void 0;return a.a.createElement(O,{suspiciousnessLevel:p,socket:e.props.socket,item:s,itemKey:i,key:i,row:t,rowKey:n,isMine:r,isSafe:o})});return a.a.createElement("ul",{className:"chunk__row",key:n},s)});return a.a.createElement("ul",{className:"map__chunk ".concat(t)},a.a.createElement("li",{className:"map chunk"},n))}}]),t}(a.a.Component),j=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).state={hintsAreHidden:!1,amountOfChunkRows:0},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return a.a.createElement("ul",{className:"map__list"},f.a.isEmpty(this.props.chunks)?"":Object.keys(this.props.chunks).map(function(t,n){return a.a.createElement("li",{className:"map__row",key:t},Object.keys(e.props.chunks[t]).map(function(s,i){var r=i===e.props.xChunkNumber&&n===e.props.yChunkNumber;return a.a.createElement(S,{key:t+s,socket:e.props.socket,chunkMap:e.props.chunks[t][s].map,suspiciousnessLevel:e.props.chunks[t][s].suspiciousnessLevel,rowMultiplier:n,colMultiplier:i,mines:e.props.mines,safe:e.props.safe,isActive:r})}))}))}}]),t}(a.a.Component),E=(n(21),n(8)),A=n.n(E),M=(n(23),{socket:new WebSocket("wss://hometask.eg1236.com/game1/"),map:void 0,rows:void 0,cols:void 0,cells:void 0,xChunksAmount:0,yChunksAmount:0,xChunkNumber:0,yChunkNumber:0,currentXStartPoint:0,currentYStartPoint:0,endOfMapIsReached:!1,currentChunkIs:[],chunks:{},mines:{},safe:{},playing:!0,decisionMade:!1,notShureChunks:{},operationStatus:void 0,hintsAreHidden:!0,title:"Lets Rock",level:2,lose:0,win:0,winRate:void 0}),I=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).state=M,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"startButtonHandler",value:function(e){e.send("new ".concat(this.state.level))}},{key:"helpButtonHandler",value:function(e){e.send("help")}},{key:"reduceDifficulty",value:function(){var e=this;this.setState(function(t){return e.state.level>1?Object(u.a)({},t,{level:t.level-1}):t})}},{key:"riseUpDifficulty",value:function(){var e=this;this.setState(function(t){return e.state.level<4?Object(u.a)({},t,{level:t.level+1}):t})}},{key:"loopThroughNeighbors",value:function(e,t){for(var n=[],s=0;s<e.neighborsArray.length;s++){var a=e.neighborsArray[s].x,i=e.neighborsArray[s].y,r=e.neighborsArray[s].chunk;n.push(t(a,i,r,e.value,e.emptyCellsCounter,e.minesAround))}return!n.some(function(e){return!1===e})}},{key:"isChunkHasNumbers",value:function(){for(var e=this.state.currentChunkIs.length,t=0;t<e;t++)if(x(this.state.currentChunkIs[t]))return t;return!1}},{key:"errasePredictions",value:function(e,t){this.setState(function(n){return A()(n,{chunks:Object(o.a)({},e,Object(o.a)({},t,{suspiciousnessLevel:{$set:{}}}))})})}},{key:"setMine",value:function(e,t,n,s,a,i){var r=n.rowName,u=g(e,t,_(n.colName),_(r)),c=u.a_x,h=u.a_y,l=u.absCoordinates;if(l in this.state.mines)return!0;var p=A()(this.state,{mines:Object(o.a)({},l,{$set:{x:c,y:h}}),endOfMapIsReached:{$set:!1}});return this.setState(p),!1}},{key:"setSafe",value:function(e,t,n,s,a,i){var r=n.rowName,u=g(e,t,_(n.colName),_(r)),c=u.a_x,h=u.a_y,l=u.absCoordinates;if(void 0===this.state.mines||l in this.state.mines)return!0;var p=A()(this.state,{safe:Object(o.a)({},l,{$set:{x:c,y:h}}),endOfMapIsReached:{$set:!1}});return this.setState(p),!1}},{key:"setSuspiciousness",value:function(e,t,n,s,a,i,r){this.setState(function(u){return A()(u,{chunks:Object(o.a)({},e,Object(o.a)({},t,{suspiciousnessLevel:Object(o.a)({},n,{$set:{value:s,counter:a,x:i,y:r}})}))})})}},{key:"analyzeOfNeighbors",value:function(e,t,n,s,a,i){var r,o,u=n.rowName,c=n.colName,h=s/(a-i),l="x".concat(e,"y").concat(t),p=g(e,t,_(c),_(u)).absCoordinates,m=void 0!==this.state.chunks[u][c]?this.state.chunks[u][c].suspiciousnessLevel[l]:void 0;return p in this.state.mines||(void 0!==m?(r=C((m.value+h)/2,-2),o=m.counter+1):(r=C(h,-2),o=1),this.setSuspiciousness(u,c,l,r,o,e,t)),!0}},{key:"areThereNeighbor",value:function(e,t){var n=this.state.yChunkNumber,s=this.state.xChunkNumber,a="col_",i="row_",r=t,o=e;if(void 0!==this.state.currentChunkIs[t]&&void 0!==this.state.currentChunkIs[t][e])return i+="".concat(this.state.yChunkNumber),a+="".concat(this.state.xChunkNumber),{x:e,y:t,value:this.state.currentChunkIs[t][e],chunk:{rowName:i,colName:a}};if((t>=y?(n+=1,r=t-y):t<0&&(n-=1,r=t+y),(i+="".concat(n))in this.state.chunks)&&(e>=d?(s+=1,o=e-d):e<0&&(s-=1,o=e+d),(a+="".concat(s))in this.state.chunks[i]))return{x:o,y:r,value:this.state.chunks[i][a].map[r][o],chunk:{rowName:i,colName:a}}}},{key:"whatDoWeHaveHere",value:function(e,t){for(var n=0,s=[],a=0,i=[{x:e-1,y:t-1},{x:e,y:t-1},{x:e+1,y:t-1},{x:e-1,y:t},{x:e+1,y:t},{x:e-1,y:t+1},{x:e,y:t+1},{x:e+1,y:t+1}],r=0;r<i.length;r++){var o=this.areThereNeighbor(i[r].x,i[r].y);if(void 0!==o&&"\u25a1"===o.value)g(o.x,o.y,_(o.chunk.colName),_(o.chunk.rowName)).absCoordinates in this.state.mines&&a++,n++,s.push(o)}return{minesAround:a,emptyCellsCounter:n,neighborsArray:s}}},{key:"makePrediction",value:function(e,t,n){var s=!0;if(void 0!==this.state.map){var a=this.whatDoWeHaveHere(t,e),i=a.minesAround,r=a.emptyCellsCounter,o=a.neighborsArray;o.length>0&&o.length>i&&(s=n===r?this.loopThroughNeighbors({neighborsArray:o,value:n,emptyCellsCounter:r,minesAround:i},this.setMine.bind(this)):n===i&&r>i?this.loopThroughNeighbors({neighborsArray:o,value:n,emptyCellsCounter:r,minesAround:i},this.setSafe.bind(this)):this.loopThroughNeighbors({neighborsArray:o,value:n,emptyCellsCounter:r,minesAround:i},this.analyzeOfNeighbors.bind(this)))}return s}},{key:"openSafeCell",value:function(){var e=this.state.safe;if(void 0===e||f.a.isEmpty(e))return!1;var t,n,s=Object.keys(e)[0],a=e[s],i=a.x,r=a.y,o=(t=s,(n=this.state.safe)[t],Object(k.a)(n,[t].map(b)));this.setState({safe:o}),this.state.socket.send("open ".concat(i," ").concat(r))}},{key:"goToTheNextChunk",value:function(){this.state.xChunkNumber<this.state.xChunksAmount?this.setState({xChunkNumber:this.state.xChunkNumber+1,currentChunkIs:this.state.chunks["row_".concat(this.state.yChunkNumber)]["col_".concat(this.state.xChunkNumber+1)].map}):this.state.yChunkNumber<this.state.yChunksAmount&&this.setState({yChunkNumber:this.state.yChunkNumber+1,xChunkNumber:0,currentChunkIs:this.state.chunks["row_".concat(this.state.yChunkNumber+1)].col_0.map})}},{key:"makeDecision",value:function(e,t){var n,s=this;if(f.a.isEmpty(this.state.chunks[e][t].suspiciousnessLevel))return!1;if(f.a.forOwn(this.state.chunks[e][t].suspiciousnessLevel,function(e,t){(void 0===n||e.value<=n.value&&!("x".concat(e.x,"y").concat(e.y)in s.state.mines))&&(n=e)}),void 0===n||"x".concat(n.x,"y").concat(n.y)in this.state.mines)return!1;var a=N(n.x,this.state.xChunkNumber,d),i=N(n.y,this.state.yChunkNumber,y);return this.errasePredictions(e,t),this.state.socket.send("open ".concat(a," ").concat(i)),!0}},{key:"componentDidMount",value:function(){var e=this;this.state.socket.onopen=function(){},document.addEventListener("keydown",function(t){9===t.keyCode&&(t.preventDefault(),e.setState(function(e){return{hintsAreHidden:!e.hintsAreHidden}}))}),this.state.socket.onmessage=function(t){var n=function(e){var t=e.data,n=f.a.split(t,"\n"),s=n[0],a=[],i=0,r=0;return n.length>1&&(i=(a=f.a.slice(n,1,n.length-1)).length,r=a[0].length),{map:a,operationStatus:s,rows:i,cols:r}}(t),s=n.map,a=n.operationStatus,i=n.cols,r=n.rows;if(console.log(t.data),e.setState({map:s,operationStatus:a,cols:i,rows:r,cells:i*r,decisionMade:!1,xChunksAmount:i/d-1,yChunksAmount:r/y-1}),void 0!==s&&s.length>0&&"open: You lose"!==a&&"open: You win"!==a&&e.state.playing){var o=w(s),u="row_".concat(e.state.yChunkNumber),c="col_".concat(e.state.xChunkNumber);e.setState({chunks:o,currentChunkIs:o[u][c].map});var h=!0,l=0,p=0,m=e.isChunkHasNumbers();if(f.a.isEmpty(e.state.safe)){if(!1!==m)e:for(var k=m;k<e.state.currentChunkIs.length;k++)if(x(e.state.currentChunkIs[k]))for(var v=0;v<e.state.currentChunkIs[k].length;v++){var b=N(v,e.state.xChunkNumber,d),C=N(k,e.state.yChunkNumber,y),g=s[C][b];if("\u25a1"!==g&&f.a.parseInt(g)>0){if(!1===(h=e.makePrediction(k,v,f.a.parseInt(g)))){e.errasePredictions(u,c);break e}}else"\u25a1"===g&&("x".concat(b,"y").concat(C)in e.state.mines||p++)}else l++;h&&(e.state.xChunksAmount!==e.state.xChunkNumber||e.state.yChunksAmount!==e.state.yChunkNumber||e.state.endOfMapIsReached?(p>0||l>0)&&e.state.endOfMapIsReached?(e.makeDecision(u,c),e.setState({endOfMapIsReached:!1,decisionMade:!0})):e.goToTheNextChunk():e.setState({xChunkNumber:0,yChunkNumber:0,endOfMapIsReached:!0})),e.state.decisionMade||e.state.socket.send("map")}else e.openSafeCell()}else if(void 0!==s&&s.length>0){var _=w(s),O="row_".concat(e.state.yChunkNumber),S="col_".concat(e.state.xChunkNumber);e.setState({chunks:_,currentChunkIs:_[O][S].map})}switch(a){case"new: OK":e.setState(M),e.state.socket.send("open 0 0");break;case"map:":case"help:":break;case"open: You lose":e.setState({title:"You lose",lose:e.state.lose+1,winRate:e.state.win/(e.state.lose+1)*100,chunks:{},playing:!1}),e.state.socket.send("new ".concat(e.state.level));break;case"open: You win":e.setState({title:"You Win",win:e.state.win+1,winRate:(e.state.win+1)/e.state.lose*100,playing:!1}),console.log(t);break;case"open: Out of bounds":break;case"open: OK":e.state.socket.send("map")}}}},{key:"render",value:function(){var e=this,t=this.state.hintsAreHidden?"map--hints-are-visible":"",n=4===this.state.level,s=1===this.state.level;return a.a.createElement("div",{className:"app"},a.a.createElement("div",{className:"app__box"},a.a.createElement("div",{className:"difficulty"},a.a.createElement("span",{className:"h2 difficulty__title"},"Choose difficulty:"),a.a.createElement("span",{className:"difficulty__inner"},a.a.createElement("button",{className:"button arrow arrow--shape-up",disabled:s,onClick:function(){return e.reduceDifficulty()}},"\u2013"),a.a.createElement("span",{className:"h2"},this.state.level),a.a.createElement("button",{className:"button arrow arrow--shape-up",disabled:n,onClick:function(){return e.riseUpDifficulty()}},"+")))),a.a.createElement("div",{className:"app__buttons"},a.a.createElement("button",{className:"button",onClick:function(){return e.helpButtonHandler(e.state.socket)}},"Help"),a.a.createElement("button",{className:"button",onClick:function(){return e.startButtonHandler(e.state.socket)}},"Start New Game")),a.a.createElement("div",{className:"app__box"},a.a.createElement("h2",null,this.state.title,": "),void 0!==this.state.map?a.a.createElement(j,{chunks:this.state.chunks,map:this.state.map,mines:this.state.mines,safe:this.state.safe,socket:this.state.socket,xChunkNumber:this.state.xChunkNumber,yChunkNumber:this.state.yChunkNumber}):""),a.a.createElement("div",{className:"app__map map ".concat(t)}))}}]),t}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[14,1,2]]]);
//# sourceMappingURL=main.c49c36bd.chunk.js.map